<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ASR: Fast Fourier Transformation</title>
    <link href="/2021/10/02/asr-fast-fourier-transform/"/>
    <url>/2021/10/02/asr-fast-fourier-transform/</url>
    
    <content type="html"><![CDATA[<h2 id="Fourier-Series"><a href="#Fourier-Series" class="headerlink" title="Fourier Series"></a>Fourier Series</h2><p>Any periodic function can be rewritten in the Fourier-series form:</p><script type="math/tex; mode=display">f(x)=A_0+\sum_{k=1}^{\infty}(a_k\cos(k x)+b_k\sin(k x))</script><p>First, we need calculate the coefficient $A_0$</p><script type="math/tex; mode=display">\int_{-\pi}^{\pi}f(x)\mathrm{d}x=2\pi A_0+\sum_{k=1}^{\infty}(\int_{-\pi}^{\pi}a_k\cos(k x)\mathrm{d}x+\int_{-\pi}^{\pi}b_k\sin(k x)\mathrm{d}x)=2\pi A_0</script><p>Thus,</p><script type="math/tex; mode=display">A_0=\frac{1}{2\pi}\int_{-\pi}^{\pi}f(x)\mathrm{d}x</script><p>Next, calculate the coefficients $a_k$</p><script type="math/tex; mode=display">\int_{-\pi}^{\pi}f(x)\cos(n x)\mathrm{d}x=\int_{-\pi}^{\pi}A_0\cos(n x)\mathrm{d}x+\sum_{k=1}^{\infty}(\int_{-\pi}^{\pi}a_k\cos(k x)\cos(n x)\mathrm{d}x+\int_{-\pi}^{\pi}b_k\sin(k x)\cos(n x)\mathrm{d}x)=2\pi A_0</script><p>Simplify the equation above.</p><script type="math/tex; mode=display">\int_{-\pi}^{\pi}f(x)\cos(n x)\mathrm{d}x=\int_{-\pi}^{\pi}a_n\cos^2(n x)\mathrm{d}x=\int_{-\pi}^{\pi}a_n(\frac{1+cos(2n x)}{2})\mathrm{d}x=a_n\pi</script><p>Thus,</p><script type="math/tex; mode=display">a_k=\frac{1}{\pi}\int_{-\pi}^{\pi}f(x)\cos(k x)\mathrm{d}x</script><p>Similarly, we can get</p><script type="math/tex; mode=display">b_k=\frac{1}{\pi}\int_{-\pi}^{\pi}f(x)\sin(k x)\mathrm{d}x</script><p>Assuming the period of the function is $T$​, we can convert it into a new function with period of $2\pi$</p><script type="math/tex; mode=display">t=\frac{2\pi x}{T}; f(x)=f(\frac{2\pi x}{T})=g(t)</script><p>Then,</p><script type="math/tex; mode=display">f(x)=g(t)=\frac{a_0}{2}+\sum_{k=1}^{\infty}(a_k\cos(\frac{2\pi k x}{T} )+b_k\sin(\frac{2\pi k x}{T} ))</script><p>Where,</p><script type="math/tex; mode=display">a_0=\frac{1}{\pi}\int_{-\pi}^{\pi}g(t)\mathrm{d}t=\frac{2}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\mathrm{d}x</script><script type="math/tex; mode=display">a_k=\frac{1}{\pi}\int_{-\pi}^{\pi}g(t)\cos(k x)\mathrm{d}t=\frac{2}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\cos(\frac{2\pi k x}{T})\mathrm{d}x</script><script type="math/tex; mode=display">b_k=\frac{1}{\pi}\int_{-\pi}^{\pi}g(t)\sin(k x)\mathrm{d}t=\frac{2}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\sin(\frac{2\pi k x}{T})\mathrm{d}x</script><h2 id="Fourier-Series-in-the-Complex-Form"><a href="#Fourier-Series-in-the-Complex-Form" class="headerlink" title="Fourier Series in the Complex Form"></a>Fourier Series in the Complex Form</h2><p>According to the Euler‘s Formula, we can convert trigonometric functions into corresponding complex forms.</p><script type="math/tex; mode=display">e^{ix}=cos(x)+isin(x);e^{-ix}=cos(x)-isin(x)</script><p>Thus, we can transform sine function and cosine function into complex forms.</p><script type="math/tex; mode=display">\cos(x)=\frac{e^{ix}+e^{-ix}}{2}</script><script type="math/tex; mode=display">sin(x)=\frac{e^{ix}-e^{-ix}}{2i}</script><p>Then, the coefficients in the Fourier Series can be written in the complex form</p><script type="math/tex; mode=display">a_k=\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\left(\exp(\frac{2\pi k ix}{T})+\exp(-\frac{2\pi k ix}{T})\right)\mathrm{d}x</script><script type="math/tex; mode=display">b_k=\frac{1}{Ti}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\left(\exp(\frac{2\pi k ix}{T})-\exp(-\frac{2\pi k ix}{T})\right)\mathrm{d}x</script><script type="math/tex; mode=display">b_k=-\frac{i}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\left(\exp(\frac{2\pi k ix}{T})-\exp(-\frac{2\pi k ix}{T})\right)\mathrm{d}x</script><p>Also, the original formula can be also rewritten</p><script type="math/tex; mode=display">f(x)=\frac{a_0}{2}+\frac{1}{2}\sum_{k=1}^{\infty}(a_k\left(\exp(\frac{2\pi k ix}{T})+\exp(-\frac{2\pi k ix}{T})\right)+\frac{b_k}{i}\left(\exp(\frac{2\pi k ix}{T})-\exp(-\frac{2\pi k ix}{T})\right) )</script><p>So,</p><script type="math/tex; mode=display">f(x)=\frac{a_0}{2}+\frac{1}{2}\sum_{k=1}^{\infty}\left(\exp(\frac{2 \pi k ix}{T})\left(a_k+\frac{b_k}{i}\right)+\exp(-\frac{2\pi k ix}{T})\left(a_k-\frac{b_k}{i}\right)\right)</script><script type="math/tex; mode=display">f(x)=\frac{a_0}{2}+\frac{1}{2}\sum_{k=1}^{\infty}\left(\exp(\frac{2\pi k ix}{T})\left(a_k-ib_k\right)+\exp(-\frac{2\pi k ix}{T})\left(a_k+ib_k\right)\right)</script><p>We can define new variable $c_k$ and $d_k$ to simplify the expression</p><script type="math/tex; mode=display">c_k=a_k-ib_k; d_k=a_k+ib_k</script><p>Then,</p><script type="math/tex; mode=display">c_k=\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\left(\exp(\frac{2\pi k ix}{T})+\exp(-\frac{2\pi k ix}{T})\right)\mathrm{d}x-\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\left(\exp(\frac{2\pi k ix}{T})-\exp(-\frac{2\pi k ix}{T})\right)\mathrm{d}x</script><p>After the simplification, we can get</p><script type="math/tex; mode=display">c_k=\frac{2}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\exp(-\frac{2\pi k ix}{T})\mathrm{d}x</script><p>Similarly,</p><script type="math/tex; mode=display">d_k=\frac{2}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\exp(\frac{2\pi k ix}{T})\mathrm{d}x</script><p>We can find the relation between $c_k$  and $d_k$</p><script type="math/tex; mode=display">d_k=c_{-k}</script><p>So,</p><script type="math/tex; mode=display">f(x)=\frac{a_0}{2}+\frac{1}{2}\sum_{k=1}^{\infty}\left(\exp(\frac{2\pi k ix}{T})c_k+\exp(-\frac{2\pi k ix}{T})c_{-k}\right)</script><p>After the simplification, we can finally get</p><script type="math/tex; mode=display">f(x)=\frac{1}{2}\sum_{k=-\infty}^{\infty}\left(\exp(\frac{2\pi k ix}{T})c_k\right )</script><p>Also, if we modify the constant factor in $c_n$</p><script type="math/tex; mode=display">c_k=\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\exp(-\frac{2\pi k ix}{T})\mathrm{d}x</script><p>The Fourier Series formula can be written in the expression below</p><script type="math/tex; mode=display">f(x)=\sum_{k=-\infty}^{\infty}\left(\exp(\frac{2\pi k ix}{T})c_k\right )</script><h2 id="Fourier-Transform"><a href="#Fourier-Transform" class="headerlink" title="Fourier Transform"></a>Fourier Transform</h2><p>According to the Fourier Series Formula, we can get</p><script type="math/tex; mode=display">f(x)=\sum_{k=-\infty}^{\infty}\left(\exp(\frac{2\pi k ix}{T})\left(\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\exp(-\frac{2\pi k ix}{T})\mathrm{d}x\right )\right)</script><p>We can replace the period time with the frequency</p><script type="math/tex; mode=display">f(x)=\sum_{k=-\infty}^{\infty}\left(\exp(k\omega ix)\left(\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(x)\exp(-k\omega ix)\mathrm{d}x\right )\right)</script><p>When $T\to \infty$, then $ \omega \to 0$ . Thus When $T \to \infty$, we have</p><script type="math/tex; mode=display">f(x)=\int_{-\infty}^{\infty}\left(\exp(\omega ix)\left(\frac{1}{2\pi}\int_{-\infty}^{\infty}f(x)\exp(-\omega ix)\mathrm{d}x\right )\right)\mathrm{d}\omega</script><p>So, the Fourier Transform can be written as</p><script type="math/tex; mode=display">F(\omega)=\int_{-\infty}^{\infty}\exp(-\omega it)f(t)\mathrm{d}t</script><script type="math/tex; mode=display">f(t)=\frac{1}{2\pi}\int_{-\infty}^{\infty}\exp(\omega ix)F(\omega)\mathrm{d}\omega</script>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>A Clumsy Attempt to Run Self-Supervised 3D Tasks</title>
    <link href="/2021/10/01/self-supervised-3d-obstacles-and-solutions/"/>
    <url>/2021/10/01/self-supervised-3d-obstacles-and-solutions/</url>
    
    <content type="html"><![CDATA[<h2 id="Before-Running"><a href="#Before-Running" class="headerlink" title="Before Running"></a>Before Running</h2><p> <strong>ImportError: cannot import name ‘parse_single_example_v2_unoptimized’ from ‘tensorflow.python.ops.parsing_ops’</strong> </p><p>This problem occurs due to the version mismatch between <code>tensorflow</code> and <code>tensorflow-gpu</code>. Reinstalling <code>tensorflow-gpu</code> will eliminate the problem.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip3 uninstall tensorflow-gpu<br>pip3 install tensorflow-gpu==2.1.0<br></code></pre></td></tr></table></figure><p><strong>ValueError: Cannot load file containing pickled data when allow_pickle=False</strong> (numpy_3d_loader.py Line22)</p><p>After print the local variable <code>path_to_image</code>, we can find that the program perceives files with prefix <code>._</code> as image files. To deal with the problem, delete these redundant files created by Mac OS.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">del</span> /f /s /q *DS_Store*<br><span class="hljs-built_in">del</span> /f /s /q *._*<br></code></pre></td></tr></table></figure><p>The problem exists after the modification above. The another reason is the compatibility problem between Nifti Image and NumPy Image. To solve the problem, we need implement an Nifti image loader. Normally, a data item in 3D dataset consist 4-dimension data (X, Y, Z, Channel). Several datasets in the Medical Decathlon consist 3-dimension tensors, lacking the channel dimension. Thus, an additional dimension is required to add to the tensors. The second problem we should handle is the inconsistency of data shapes. Therefore, we need to use <code>skimage</code> to regularize their sizes before feeding the data into the data generator.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nifti_load</span>(<span class="hljs-params">path, padding_channel=<span class="hljs-literal">False</span>, do_cubic_resize=<span class="hljs-literal">False</span></span>):</span><br>    data = nib.load(path).get_fdata()<br>    <span class="hljs-keyword">if</span> do_cubic_resize:<br>        data = transform.resize(data, (<span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>))<br>        data = np.asarray(data)<br>    <span class="hljs-keyword">if</span> padding_channel:<br>        data = np.expand_dims(data, <span class="hljs-built_in">len</span>(data.shape))<br>    <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></table></figure><p>This problem is tricky and exhausting. The issue in the original repository helped me.</p><p><a href="https://github.com/HealthML/self-supervised-3d-tasks/issues/15">https://github.com/HealthML/self-supervised-3d-tasks/issues/15</a></p><p><strong>Insufficient GPU Memory</strong></p><p>This problem can be solved by decreasing the filter and batch size. However, This also decreases the quality of training results.</p><h2 id="Running-on-the-Server"><a href="#Running-on-the-Server" class="headerlink" title="Running on the Server"></a>Running on the Server</h2><p><strong>Before transferring the code to the server</strong></p><p>Inspect paths starting with <code>~</code>, which ensures that all workspace data will be stored in the corresponding directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~<br>mkdir workspace<br></code></pre></td></tr></table></figure><p>Then install TensorFlow 2.1.0 in the user directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install --user -i https://pypi.tuna.tsinghua.edu.cn/simple tensorflow==2.1.0<br>pip install --user -i https://pypi.tuna.tsinghua.edu.cn/simple tensorflow-gpu==2.1.0<br></code></pre></td></tr></table></figure><p>Execute the command and Tensorflow returned a tensor. The installation completed.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python3 -c <span class="hljs-string">&quot;import tensorflow as tf; print(tf.reduce_sum(tf.random.normal([1000, 1000])))&quot;</span><br></code></pre></td></tr></table></figure><p>Finally, use <code>scp</code> command to upload source codes.</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
